(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function o(e){e.textContent="Сохранение..."}function r(e){e.textContent="Сохранить"}function c(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}e.d({},{H:()=>G});var a={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"d1bd9214-4aa4-446a-86e1-bed9a18b0675","Content-Type":"application/json"}};function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u,i,d=function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then(l)},s=function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:a.headers}).then(l)},p=document.getElementById("card").content,f=document.querySelector(".gallery__cards"),m=document.querySelector(".popup_type_delete-card"),_="8e15e35f8605fbee226dfffc";function h(e){var n,o=p.cloneNode(!0),r=e.name,c=e.link,a=o.querySelector(".gallery__like-button"),l=o.querySelector(".gallery__delete-button"),f=o.querySelector(".gallery__photo");try{n=e.likes.length,e.likes.some((function(e){return e._id===_}))&&a.classList.add("gallery__like-button_active")}catch(e){n="0"}return o.querySelector(".gallery__like-number").textContent=n,e.owner._id!==_&&l.remove(),f.setAttribute("src",c),f.setAttribute("alt",r),o.querySelector(".gallery__place").textContent=r,a.addEventListener("click",(function(){a.classList.contains("gallery__like-button_active")?s(e._id).then((function(e){a.nextElementSibling.textContent=e.likes.length})).catch((function(e){console.log(e)})):d(e._id).then((function(e){a.nextElementSibling.textContent=e.likes.length})).catch((function(e){console.log(e)})),a.classList.toggle("gallery__like-button_active")})),l.addEventListener("click",(function(n){u=n.target.closest(".gallery__card"),i=e._id,t(m)})),f.addEventListener("click",(function(){return G(r,c)})),o}function y(e){f.prepend(e)}var v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inputErrorClass:"popup__input_type_error"};function b(e){e.disabled=!0}function g(e,t){e.querySelectorAll(t.inputSelector).forEach((function(n){n.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){document.getElementById("".concat(e.id,"-error")).textContent="",e.classList.remove(t.inputErrorClass)}(e,t):function(e,t,n){document.getElementById("".concat(e.id,"-error")).textContent=t,e.classList.add(n.inputErrorClass)}(e,e.validationMessage,t)})(n,t),function(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):b(t)}(e,e.lastElementChild)}))}))}var E,S=document.querySelector(".popup_type_edit-profile"),k=document.querySelector(".popup_type_add-card"),q=document.querySelector(".popup_type_open-card"),C=document.querySelector(".popup_type_edit-avatar"),L=document.querySelector(".popup_type_delete-card"),x=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__avatar"),I=document.querySelectorAll(".popup__close-button"),U=S.querySelector(".popup__form"),A=k.querySelector(".popup__form"),O=C.querySelector(".popup__form"),P=L.querySelector(".popup__form"),T=document.getElementById("username"),D=document.getElementById("description"),j=document.getElementById("title"),N=document.getElementById("url"),H=document.getElementById("photo"),J=document.querySelector(".profile__username"),z=document.querySelector(".profile__description"),M=document.querySelector(".profile__avatar"),V=document.querySelector(".opened-card__photo"),F=document.querySelector(".opened-card__caption");function G(e,n){V.setAttribute("src",n),V.setAttribute("alt",e),F.textContent=e,t(q)}x.addEventListener("click",(function(){t(S),T.value=J.textContent,D.value=z.textContent})),B.addEventListener("click",(function(){t(k),b(k.querySelector(v.submitButtonSelector))})),w.addEventListener("click",(function(){t(C),b(C.querySelector(v.submitButtonSelector))})),I.forEach((function(e){var t=e.closest(".popup");t.addEventListener("mousedown",(function(e){return function(e,t){(e.target.classList.contains("popup")||e.target.classList.contains("popup__container"))&&n(t)}(e,t)})),e.addEventListener("click",(function(){return n(t)}))})),U.addEventListener("submit",(function(e){var t,c,u;o(U.lastElementChild),t=e,c=U.lastElementChild,t.preventDefault(),(u={username:T.value,description:D.value},fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:u.username,about:u.description}),headers:a.headers}).then(l)).then((function(e){J.textContent=e.name,z.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){r(c),n(S)}))})),A.addEventListener("submit",(function(e){var t,c,u;o(A.lastElementChild),t=e,c=A.lastElementChild,t.preventDefault(),(u={name:j.value,link:N.value},fetch("".concat(a.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:u.name,link:u.link}),headers:a.headers}).then(l)).then((function(e){console.log(e.owner._id);var t={owner:{}};t.name=e.name,t.link=e.link,t._id=e._id,t.owner._id=e.owner._id,console.log(t),y(h(t))})).catch((function(e){console.log(e)})).finally((function(){r(c),t.target.reset(),n(k)}))})),O.addEventListener("submit",(function(e){var t,c,u;o(O.lastElementChild),t=e,c=O.lastElementChild,t.preventDefault(),(u={photo:H.value},fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:u.photo}),headers:a.headers}).then(l)).then((function(e){M.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){r(c),t.target.reset(),n(C)}))})),P.addEventListener("submit",(function(e){return e.preventDefault(),void(t=i,fetch("".concat(a.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:a.headers}).then(l)).then((function(){u.remove()})).catch((function(e){console.log(e)})).finally((function(){return n(L)}));var t})),fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then(l).then((function(e){J.textContent=e.name,z.textContent=e.about,M.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then(l).then((function(e){e.forEach((function(e){y(h(e))}))})).catch((function(e){console.log(e)})),E=v,document.querySelectorAll(E.formSelector).forEach((function(e){return g(e,E)}))})();